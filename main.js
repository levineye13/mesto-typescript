(()=>{var e={69:()=>{}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}(()=>{"use strict";s(69);const e=class{constructor(e,t){this._container=document.querySelector(e),this._items=t?t.items:[],this._renderer=t?t.renderCallback:()=>{}}appendItem(e){this._container.append(e)}prependItem(e){this._container.prepend(e)}renderItems(){this._items.forEach((e=>this._renderer(e)))}},t="https://mesto.nomoreparties.co/v1/cohort-16",i="f1f27dcb-4c71-4cd5-a34d-2e8f5fd4811e",n=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__update-button"),o=(document.querySelector("#name-input"),document.querySelector("#job-input"),".elements__list"),c="PATCH",l="DELETE",h=class{constructor(e){this._popupOpened="popup_opened",this._handleEscClose=e=>{"Escape"===e.key&&this.close()},this._handleScreenClickClose=e=>{e.target.classList.contains(this._popupOpened)&&this.close()},this._handleButtonClose=e=>{e.target.classList.contains("popup__close-button")&&this.close()},this._popup=document.querySelector(e)}open(){this._popup.classList.add(this._popupOpened),this._setEventListeners()}close(){this._popup.classList.remove(this._popupOpened),this._removeEventListeners()}_setEventListeners(){document.addEventListener("keydown",this._handleEscClose),this._popup.addEventListener("click",this._handleButtonClose),this._popup.addEventListener("click",this._handleScreenClickClose)}_removeEventListeners(){document.removeEventListener("keydown",this._handleEscClose),this._popup.removeEventListener("click",this._handleButtonClose),this._popup.removeEventListener("click",this._handleScreenClickClose)}},d=class extends h{constructor(e,t){super(e),this._handleSubmit=e=>{e.preventDefault(),this._handleSubmitCallback(this._getInputValues())},this.open=()=>{super.open(),this._setEventListeners()},this.close=()=>{super.close(),this._form.reset(),this._removeEventListeners()},this._form=this._popup.querySelector(".popup__form"),this._handleSubmitCallback=t.handleSubmitCallback}_getInputValues(){const e=this._form.querySelectorAll(".popup__input");return Array.from(e).reduce(((e,t)=>{const s=t;return Object.assign(Object.assign({},e),{[s.name]:s.value})}),{})}_setEventListeners(){super._setEventListeners(),this._form.addEventListener("submit",this._handleSubmit)}_removeEventListeners(){super._removeEventListeners(),this._form.removeEventListener("submit",this._handleSubmit)}};class u extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,this.statusText=e.statusText}parseErrorToJson(){return JSON.stringify({message:this.message,name:this.name,status:this.status,statusText:this.statusText})}}const _=u;const p=class{constructor(e){this._baseUrl=e._baseUrl,this._headers=e._headers}_checkResponceStatus(e){return new Promise(((t,s)=>e.ok?t(e.json()):s(new _({message:`Error: ${e.status} - ${e.statusText}`,status:e.status,statusText:e.statusText}))))}static getInitialData(e){return t=this,s=void 0,n=function*(){const t="function"==typeof e?[e]:Array.isArray(e)?[...e]:[];return Promise.all(t.map((e=>e())))},new((i=void 0)||(i=Promise))((function(e,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function o(e){try{c(n.throw(e))}catch(e){r(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(a,o)}c((n=n.apply(t,s||[])).next())}));var t,s,i,n}};var m=function(e,t,s,i){return new(s||(s=Promise))((function(n,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function o(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const v=new class extends p{constructor(e,t){super({_baseUrl:e,_headers:t}),this.getUser=()=>m(this,void 0,void 0,(function*(){try{const e=yield fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:Object.assign({},this._headers)});return this._checkResponceStatus(e)}catch(e){return e}}))}editProfile(e){return m(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this._baseUrl}/users/me`,{method:c,headers:Object.assign({},this._headers),body:JSON.stringify({name:e.name,about:e.about})});return this._checkResponceStatus(t)}catch(e){return e}}))}updateAvatar(e){return m(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this._baseUrl}/users/me/avatar`,{method:c,headers:Object.assign({},this._headers),body:JSON.stringify({avatar:e})});return this._checkResponceStatus(t)}catch(e){return e}}))}}(t,{Authorization:i,Accept:"application/json","Content-Type":"application/json"});var k=function(e,t,s,i){return new(s||(s=Promise))((function(n,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function o(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const b=new class extends p{constructor(e,t){super({_baseUrl:e,_headers:t}),this.getCards=()=>k(this,void 0,void 0,(function*(){try{const e=yield fetch(`${this._baseUrl}/cards`,{method:"GET",headers:Object.assign({},this._headers)});return this._checkResponceStatus(e)}catch(e){return e}}))}addCard(e){return k(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this._baseUrl}/cards`,{method:"POST",headers:Object.assign({},this._headers),body:JSON.stringify({name:e.name,link:e.link})});return this._checkResponceStatus(t)}catch(e){return e}}))}deleteCard(e){return k(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this._baseUrl}/cards/${e}`,{method:l,headers:Object.assign({},this._headers)});return this._checkResponceStatus(t)}catch(e){return e}}))}likeCard(e){return k(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:Object.assign({},this._headers)});return this._checkResponceStatus(t)}catch(e){return e}}))}dislikeCard(e){return k(this,void 0,void 0,(function*(){try{const t=yield fetch(`${this._baseUrl}/cards/likes/${e}`,{method:l,headers:Object.assign({},this._headers)});return this._checkResponceStatus(t)}catch(e){return e}}))}}(t,{Authorization:i,Accept:"application/json","Content-Type":"application/json"});var f=function(e,t,s,i){return new(s||(s=Promise))((function(n,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function o(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(a,o)}c((i=i.apply(e,t||[])).next())}))};const y=new class{constructor(){this._loaderElement=document.querySelector(".loader"),this.start=()=>{this._loaderElement.classList.add("loader_active")},this.stop=()=>{this._loaderElement.classList.remove("loader_active")}}},C=new class{constructor(e){this._id="",this._name=document.querySelector(e.titleSelector),this._about=document.querySelector(e.subtitleSelector),this._avatar=document.querySelector(e.avatarSelector)}set setAvatar(e){this._avatar.src=e}set setName(e){this._name.textContent=e}set setAbout(e){this._about.textContent=e}get getId(){return this._id}set setUser(e){this._id=e._id,this._name.textContent=e.name,this._about.textContent=e.about,this._avatar.src=e.avatar}get getUser(){return{_id:this._id,name:this._name.textContent||"",about:this._about.textContent||"",avatar:this._avatar.src||""}}}({titleSelector:".profile__title",subtitleSelector:".profile__subtitle",avatarSelector:".profile__avatar"}),S=new class extends h{constructor(e){super(e),this.open=(e,t)=>{this._title.textContent=e||"",this._image.src=t||"",this._image.alt=e||"",super.open()},this._image=document.querySelector(".popup__card-img"),this._title=document.querySelector(".popup__title-img")}}(".popup_type_image"),L=new d(".popup_type_update-avatar",{handleSubmitCallback:e=>{((e,t="")=>{f(void 0,void 0,void 0,(function*(){try{const s=yield v.updateAvatar(t);s&&(C.setAvatar=s.avatar,e.close())}catch(e){console.error(e)}}))})(L,e.link)}}),g=new d(".popup_type_profile",{handleSubmitCallback:e=>{((e,t="",s="")=>{f(void 0,void 0,void 0,(function*(){try{const i=yield v.editProfile({name:t,about:s});i&&(C.setName=i.name,C.setAbout=i.about,e.close())}catch(e){console.error(e)}}))})(g,e.name,e.about)}}),E=new d(".popup_type_add-card",{handleSubmitCallback:t=>{((t,s="",i="")=>{f(void 0,void 0,void 0,(function*(){try{const n=yield b.addCard({name:s,link:i});if(n){const s=w(n).getView();new e(o).prependItem(s),t.close()}}catch(e){console.error(e)}}))})(E,t.place,t.link)}}),x=new class extends h{constructor(e,t){super(e),this._itemId="",this._itemMarkup=null,this._handleSubmit=e=>{e.preventDefault(),this._itemId&&this._itemMarkup&&this._handleSubmitCallback(this._itemId,this._itemMarkup)},this.open=()=>{super.open(),this._setEventListeners()},this.close=()=>{super.close(),this._removeEventListeners()},this._form=this._popup.querySelector(".popup__form"),this._handleSubmitCallback=t.handleSubmitCallback}_setEventListeners(){super._setEventListeners(),this._form.addEventListener("submit",this._handleSubmit)}_removeEventListeners(){super._removeEventListeners(),this._form.removeEventListener("submit",this._handleSubmit)}set setItemId(e){this._itemId=e}set setItemMarkup(e){this._itemMarkup=e}}(".popup_type_confirm",{handleSubmitCallback:(e,t)=>{((e,t,s)=>{f(void 0,void 0,void 0,(function*(){try{(yield b.deleteCard(t))&&(s.remove(),e.close())}catch(e){console.error(e)}}))})(x,e,t)}}),w=e=>new class{constructor(e,t){this._isLiked=!1,this._cardSelector=e,this._data=t.data,this._handleClickCallback=t.handleClickCallback,this._handleLikeCallback=t.handleLikeCallback,this._handleDislikeCallback=t.handleDislikeCallback,this._handleDeleteCallback=t.handleDeleteCallback,this._likeNumbers=this._data.likes.length}_getTemplate(){return document.querySelector(this._cardSelector).content.cloneNode(!0).children[0]}get getLikeState(){return this._isLiked}get getId(){return this._data._id}checkLike(e,t){if(this._data.likes.some((t=>t._id===e))){const e=t.querySelector(".elements__like-button");this._isLiked=!0,e.classList.add("elements__like-button_active")}}checkOwner(e,t){var s;this._data.owner._id===e||null===(s=t.querySelector(".elements__delete-card"))||void 0===s||s.remove()}_like(e,t){this._isLiked=!0,this._likeNumbers++,e.textContent=this._likeNumbers.toString(),t.classList.add("elements__like-button_active")}_dislike(e,t){this._isLiked=!1,this._likeNumbers--,e.textContent=this._likeNumbers.toString(),t.classList.remove("elements__like-button_active")}_handleClick(e,t){this._handleClickCallback(e,t)}_handleDelete(e){this._handleDeleteCallback(e)}_handleLike(e,t){this._handleLikeCallback(this._data._id),this._like(e,t)}_handleDislike(e,t){this._handleDislikeCallback(this._data._id),this._dislike(e,t)}_handleChangeLike(e,t){this._isLiked?this._handleDislike(e,t):this._handleLike(e,t)}_setEventListeners(e,t){e.querySelector(".elements__delete-card").addEventListener("click",(t=>{t.stopPropagation(),this._handleDelete(e)}));const s=e.querySelector(".elements__like-button");s.addEventListener("click",(e=>{e.stopPropagation(),this._handleChangeLike(t,s)})),e.addEventListener("click",(()=>this._handleClick(this._data.name,this._data.link)))}getView(){const e=this._getTemplate(),t=e.querySelector(".elements__img"),s=e.querySelector(".elements__title"),i=e.querySelector(".elements__like-count");return this._setEventListeners(e,i),t.src=this._data.link,t.alt=this._data.name,s.textContent=this._data.name,i.textContent=this._likeNumbers.toString(),e}}("#template-card",{data:e,handleClickCallback:(e,t)=>{S.open(e,t)},handleDeleteCallback:t=>{x.setItemId=e._id,x.setItemMarkup=t,x.open()},handleLikeCallback:e=>{(e=>{f(void 0,void 0,void 0,(function*(){try{yield b.likeCard(e)}catch(e){console.error(e)}}))})(e)},handleDislikeCallback:e=>{(e=>{f(void 0,void 0,void 0,(function*(){try{yield b.dislikeCard(e)}catch(e){console.error(e)}}))})(e)}});f(void 0,void 0,void 0,(function*(){try{y.start();const t=yield p.getInitialData([v.getUser,b.getCards]),[s,i]=t;C.setUser=s;const c=i.map((e=>w(e))),l=new e(o,{items:c,renderCallback:e=>{const t=e.getView(),s=C.getId;e.checkLike(s,t),e.checkOwner(s,t),l.appendItem(t)}});l.renderItems(),n.addEventListener("click",g.open),a.addEventListener("click",L.open),r.addEventListener("click",E.open)}catch(e){console.error(e)}finally{y.stop()}}))})()})();